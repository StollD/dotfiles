;; -*- mode: emacs-lisp; lexical-binding: t -*-

;; This file is designed to be plugged into an unchanged ~/.spacemacs file
;; This allows you to only set the options you actually want to change,
;; and use the default values for everything else.
;;
;; Add (load "~/.config/spacemacs") to the end of ~/.spacemacs to enable
;; the options from this file. If you want to load emacs with the defaults,
;; just comment out loading this file.

(defun dotspacemacs/user-layers ()
	(setq-default dotspacemacs-configuration-layers '(
		auto-completion
		dap
		git
		ivy
		lsp
		syntax-checking
		tabs
		themes-megapack
		version-control

		(treemacs :variables
			treemacs-use-git-mode 'extended)

		(c-c++ :variables
			c-c++-enable-clang-support t
			c-c++-backend 'lsp-ccls
			c-c++-enable-clang-format-on-save t
			c-c++-adopt-subprojects t)

		(go :variables
			go-backend 'lsp
			go-format-before-save t
			go-tab-width nil)

		emacs-lisp
		json
		markdown
		meson
		shell-scripts
		systemd
		yaml))
)

(advice-add 'dotspacemacs/layers :after #'dotspacemacs/user-layers)

(defun dotspacemacs/user-init ()
	(setq-default
		dotspacemacs-scratch-buffer-persistent t
		dotspacemacs-themes '(doom-Iosvkem)
		dotspacemacs-mode-line-theme '(all-the-icons :separator arrow)
		dotspacemacs-loading-progress-bar nil
		dotspacemacs-enable-server t
		dotspacemacs-persistent-server t
		dotspacemacs-line-numbers t)

	(setq-default
		doom-Iosvkem-brighter-comments t
		doom-Iosvkem-comment-bg t
		doom-Iosvkem-padded-modeline t)

	(setq-default warning-suppress-types '((comp)))
	(setq-default show-trailing-whitespace t)

	(require 'whitespace)
	(setq whitespace-style '(
		face
		empty
		indentation
		lines-tail
		space-after-tab
		space-before-tab
		trailing))

	(global-whitespace-mode t)
	(global-display-fill-column-indicator-mode t)
)

;; Read the maximum line length for whitespace mode from editorconfig
(defun editorconfig-whitespace (length)
	(setq whitespace-line-column fill-column))

(advice-add 'editorconfig-set-line-length :after #'editorconfig-whitespace)
