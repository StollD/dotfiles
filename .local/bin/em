#!/bin/sh

TRAMP="/tb::"

while getopts ":nt" args; do
	case "$args" in
	n)
		NB="1"
		;;
	t)
		NT="1"
		;;
	esac
done
shift $((OPTIND-1))

FILE="$1"
if [ ! "$FILE" = "" ] && [ "$NT" = "" ]; then
	FILE="$TRAMP$(readlink -f "$FILE")"
fi
FRAMES="$(emacsclient -e '(length (frame-list))')"

_eclient() {
	if [ "$NB" = "" ]; then
		if [ "$FRAMES" -gt 1 ]; then
			emacsclient "$@"
		else
			emacsclient -c "$@"
		fi
	else
		if [ "$FRAMES" -gt 1 ]; then
			emacsclient -n "$@"
		else
			emacsclient -nc "$@"
		fi
	fi
}

if [ ! "$FILE" = "" ]; then
	_eclient "$FILE"
else
	_eclient
fi
